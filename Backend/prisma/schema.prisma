generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

////////////////////
/// ADMIN
////////////////////
model Admin {
  adminId String @id @default(auto()) @map("_id") @db.ObjectId

  username String @unique
  name     String
  password String
  role     Int @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime?

  roomsCreated Room[] @relation("RoomCreatedBy")
  roomsUpdated Room[] @relation("RoomUpdatedBy")

  billsCreated Bill[] @relation("BillCreatedBy")
  billsUpdated Bill[] @relation("BillUpdatedBy")
}

////////////////////
/// ROOM
////////////////////
model Room {
  roomId String @id @default(auto()) @map("_id") @db.ObjectId

  number     String @unique
  size       String
  rent       Int
  deposit    Int
  bookingFee Int
  status     Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime?

  createdBy String @db.ObjectId
  updatedBy String? @db.ObjectId

  adminCreated Admin? @relation(
    "RoomCreatedBy",
    fields: [createdBy],
    references: [adminId]
  )

  adminUpdated Admin? @relation(
    "RoomUpdatedBy",
    fields: [updatedBy],
    references: [adminId]
  )

  bookings  Booking[]
  bills     Bill[]
  checkouts Checkout[]
}

////////////////////
/// CUSTOMER
////////////////////
model Customer {
  customerId String @id @default(auto()) @map("_id") @db.ObjectId

  userId   String
  userName String

  createdAt DateTime @default(now())
  updatedAt DateTime?

  bookings  Booking[]
  bills     Bill[]
  payments  Payment[]
  checkouts Checkout[]
}

////////////////////
/// BOOKING
////////////////////
model Booking {
  bookingId String @id @default(auto()) @map("_id") @db.ObjectId

  roomId     String @db.ObjectId
  customerId String @db.ObjectId

  ctitle   String?
  cname    String?
  csurname String?
  fullName String?
  cphone   String?
  cmumId   String?

  bookingDate DateTime @default(now())

  checkin       DateTime
  checkinAt     DateTime?
  checkinStatus Int @default(0)

  approveStatus Int @default(0)
  approvedAt    DateTime?

  slipUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime?

  room     Room     @relation(fields: [roomId], references: [roomId])
  customer Customer @relation(fields: [customerId], references: [customerId])

  checkout Checkout?
  bills    Bill[]

  @@index([roomId])
  @@index([customerId])
  @@index([approveStatus])
}

////////////////////
/// CHECKOUT
////////////////////
model Checkout {
  checkoutId String @id @default(auto()) @map("_id") @db.ObjectId

  bookingId  String @unique @db.ObjectId
  roomId     String @db.ObjectId
  customerId String @db.ObjectId

  checkout DateTime

  ReturnApprovalStatus Int @default(0)
  RefundApprovalDate   DateTime?

  checkoutStatus Int @default(0)
  checkoutAt     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime?

  booking  Booking  @relation(fields: [bookingId], references: [bookingId])
  room     Room     @relation(fields: [roomId], references: [roomId])
  customer Customer @relation(fields: [customerId], references: [customerId])

  @@index([checkoutStatus])
  @@index([ReturnApprovalStatus])
}

////////////////////
/// BILL
////////////////////
model Bill {
  billId String @id @default(auto()) @map("_id") @db.ObjectId

  billNumber String @unique

  roomId     String? @db.ObjectId
  customerId String? @db.ObjectId
  bookingId  String? @db.ObjectId

  month DateTime

  ctitle   String?
  cname    String?
  csurname String?
  fullName String?
  cphone   String?

  total      Int @default(0)
  billStatus Int @default(0)

  billDate DateTime?
  paidAt   DateTime?

  dueDate DateTime
  slipUrl String?

  rent         Int
  service      Int @default(50)

  wBefore   Int
  wAfter    Int
  wUnits    Int
  waterCost Int @default(0)

  eBefore      Int
  eAfter       Int
  eUnits       Int
  electricCost Int @default(0)

  fine        Int @default(0)
  overdueDays Int @default(0)

  lastOverdueNotifyAt DateTime?

  createdAt DateTime @default(now())
  createdBy String @db.ObjectId

  updatedAt DateTime?
  updatedBy String? @db.ObjectId

  room     Room?     @relation(fields: [roomId], references: [roomId])
  customer Customer? @relation(fields: [customerId], references: [customerId])
  booking  Booking?  @relation(fields: [bookingId], references: [bookingId])

  adminCreated Admin? @relation(
    "BillCreatedBy",
    fields: [createdBy],
    references: [adminId]
  )

  adminUpdated Admin? @relation(
    "BillUpdatedBy",
    fields: [updatedBy],
    references: [adminId]
  )

  payment Payment?

  @@index([roomId])
  @@index([customerId])
  @@index([billStatus])
}

////////////////////
/// PAYMENT
////////////////////
model Payment {
  paymentId String @id @default(auto()) @map("_id") @db.ObjectId

  billId     String @unique @db.ObjectId
  customerId String @db.ObjectId

  paidAt  DateTime?
  slipUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime?

  bill     Bill     @relation(fields: [billId], references: [billId])
  customer Customer @relation(fields: [customerId], references: [customerId])
}

////////////////////
/// DORM PROFILE
////////////////////
model DormProfile {
  dormId String @id @default(auto()) @map("_id") @db.ObjectId

  key String @unique @default("MAIN")

  dormName String
  address  String
  phone    String
  email    String

  taxId   String
  taxType Int @default(0)

  receiverTitle    String?
  receiverName     String?
  receiverSurname  String?
  receiverFullName String?

  service           Int   @default(50)
  waterRate         Float @default(0)
  electricRate      Float @default(0)
  overdueFinePerDay Int   @default(0)

  signatureUrl String?

  createdAt DateTime @default(now())
  updatedAt DateTime?
}